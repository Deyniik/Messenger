<!DOCTYPE html>
<html>
<head>
    <title>Test Messenger</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="testWrite()">–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏</button>
    <button onclick="testRead()">–¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è</button>
    <div id="log"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBk4nxZ1ldNQUCxsbgaeYTkm9stq0o9o2Q",
            authDomain: "deygram-e4814.firebaseapp.com",
            projectId: "deygram-e4814",
            storageBucket: "deygram-e4814.firebasestorage.app",
            messagingSenderId: "591207353726",
            appId: "1:591207353726:web:d20f5e648d3daf86fcb72f"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function log(msg) {
            document.getElementById('log').innerHTML += msg + '<br>';
            console.log(msg);
        }

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    log('‚úÖ –í–æ—à–µ–ª –∫–∞–∫: ' + result.user.displayName);
                })
                .catch(error => {
                    log('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                });
        }

        function testWrite() {
            if (!auth.currentUser) {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏!');
                return;
            }

            db.collection('testUsers').doc(auth.currentUser.uid).set({
                name: auth.currentUser.displayName,
                online: true,
                timestamp: new Date()
            })
            .then(() => log('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–∞!'))
            .catch(error => log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ' + error.message));
        }

        function testRead() {
            db.collection('testUsers').get()
                .then(snapshot => {
                    log('üìñ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + snapshot.size);
                    snapshot.forEach(doc => {
                        log('üë§ ' + doc.data().name + ' - ' + doc.data().online);
                    });
                })
                .catch(error => log('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: ' + error.message));
        }

        // –ê–≤—Ç–æ-—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        auth.onAuthStateChanged(user => {
            if (user) {
                log('üîë –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ' + user.displayName);
                testRead();
            }
        });
    </script>
</body>
</html>
